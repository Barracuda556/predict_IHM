<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Non-ST-segment elevation acute coronary syndrome in-hospital mortality calculator</title>
    <style>
        body { 
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .form-group label {
            width: 350px;
            margin-right: 10px;
            font-weight: bold;
        }
        input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100px;
        }
        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 120px;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
            display: block;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .model-section {
            border-bottom: 2px solid #3498db;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .model-title {
            color: #3498db;
            margin-bottom: 15px;
        }
        .units {
            color: #666;
            font-size: 0.9em;
            margin-left: 5px;
        }
        .error {
            border-color: red !important;
        }
        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Non-ST-segment elevation acute coronary syndrome in-hospital mortality calculator</h1>
        
        <!-- Модель 1 -->
        <div class="model-section" id="model1-section">
            <h2 class="model-title">Upon admission</h2>
            <div class="form-group">
                <label for="age">Age <span class="units">(years)</span>:</label>
                <input type="number" id="age" name="age" min="18" max="120">
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="killip">Acute Heart Failure (AHF):</label>
                <select id="killip" name="killip">
                    <option value="">-- Select --</option>
                    <option value="1">I (no AHF)</option>
                    <option value="2">II (rales and/or jugular vein distention (JVD))</option>
                    <option value="3">III (pulmonary edema)</option>
                    <option value="4">IV (cardiogenic shock)</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="sad">Systolic Blood Pressure <span class="units">(mmHg)</span>:</label>
                <input type="number" id="sad" name="sad" min="50" max="250">
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="heartRate">Heart Rate <span class="units">(Beats Per Minute (BPM))</span>:</label>
                <input type="number" id="heartRate" name="heartRate" min="30" max="200">
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="bmi">Body Mass Index (BMI) <span class="units">(kg/m²)</span>:</label>
                <input type="number" id="bmi" name="bmi" step="0.1" min="10" max="50">
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="communityPneumonia">Community-Acquired Pneumonia (CAP):</label>
                <select id="communityPneumonia" name="communityPneumonia">
                    <option value="">-- Select --</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
		    <option value="None">Unknown</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="weakness">Signs of weakness:</label>
                <select id="weakness" name="weakness">
                    <option value="">-- Select --</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="charlson">Charlson Comorbidity Index (CCI) <span class="units">(scores)</span>:</label>
                <input type="number" id="charlson" name="charlson" min="0" max="30">
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="familyHistory">Family History of Cardiovascular Disease (FHCD):</label>
                <select id="familyHistory" name="familyHistory">
                    <option value="">-- Select --</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="dryWheezing">Dry crackles:</label>
                <select id="dryWheezing" name="dryWheezing">
                    <option value="">-- Select --</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="consciousnessLoss">Syncope:</label>
                <select id="consciousnessLoss" name="consciousnessLoss">
                    <option value="">-- Select --</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <button class="btn" onclick="calculate(1)">Calculate</button>
        </div>
        
        <!-- Модель 2 -->
        <div class="model-section" id="model2-section">
            <h2 class="model-title">Laboratory data</h2>
            <div class="form-group">
                <label for="creatinine">Creatinine <span class="units">(µmol/l)</span>:</label>
                <input type="number" id="creatinine" name="creatinine" step="0.1" min="20" max="1000">
                <div class="error-message">This field is required</div>
            </div>
            <div class="form-group">
                <label for="hematocrit">Hematocrit <span class="units">(%)</span>:</label>
                <input type="number" id="hematocrit" name="hematocrit" step="0.1" min="10" max="60">
                <div class="error-message">This field is required</div>
            </div>
            <button class="btn" onclick="calculate(2)">Calculate</button>
        </div>
        
        <!-- Модель 3 -->
        <div class="model-section" id="model3-section">
            <h2 class="model-title">Instrumental data</h2>
            <div class="form-group">
                <label for="lvDysfunction">Left ventricular systolic dysfunction (left ventricular ejection fraction (LVEF) ≤ 49%):</label>
                <select id="lvDysfunction" name="lvDysfunction">
                    <option value="">-- Select --</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <button class="btn" onclick="calculate(3)">Calculate</button>
        </div>
        
        <!-- Модель 4 -->
        <div class="model-section" id="model4-section">
            <h2 class="model-title">During hospitalization</h2>
            <div class="form-group">
                <label for="hospitalPneumonia">Hospital-Acquired Pneumonia (HAP):</label>
                <select id="hospitalPneumonia" name="hospitalPneumonia">
                    <option value="">-- Select --</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
                <div class="error-message">This field is required</div>
            </div>
            <button class="btn" onclick="calculate(4)">Calculate</button>
        </div>
    </div>

    <script>
        function calculate(modelNumber) {
            // Собираем данные для всех требуемых моделей
            let data = {};
            let isValid = true;

            // Проверяем и собираем данные для модели 1 (всегда требуется)
            if (!validateModel(1)) {
                isValid = false;
            } else {
                data.model1 = getModel1Data();
            }

            // Если запрошены модели 2-4, проверяем и их
            if (modelNumber >= 2) {
                if (!validateModel(2)) {
                    isValid = false;
                } else {
                    data.model2 = getModel2Data();
                }
            }

            if (modelNumber >= 3) {
                if (!validateModel(3)) {
                    isValid = false;
                } else {
                    data.model3 = getModel3Data();
                }
            }

            if (modelNumber >= 4) {
                if (!validateModel(4)) {
                    isValid = false;
                } else {
                    data.model4 = getModel4Data();
                }
            }

            if (!isValid) {
                alert('Пожалуйста, заполните все обязательные поля для выбранных моделей');
                return;
            }

            // Добавляем номер целевой модели
            data.targetModel = modelNumber;
            
            // Отправляем данные на сервер
            sendData(data);
        }

        function validateModel(modelNumber) {
            let isValid = true;
            const fields = getModelFields(modelNumber);

            fields.forEach(field => {
                const element = document.getElementById(field.id);
                const errorElement = element.nextElementSibling;
                
                // Проверяем, заполнено ли поле
                if (!element.value || (element.type === 'number' && isNaN(element.value))) {
                    element.classList.add('error');
                    errorElement.style.display = 'block';
                    isValid = false;
                } else {
                    element.classList.remove('error');
                    errorElement.style.display = 'none';
                }
            });

            return isValid;
        }

        function getModelFields(modelNumber) {
            switch(modelNumber) {
                case 1:
                    return [
                        {id: 'age', type: 'number'},
                        {id: 'killip', type: 'select'},
                        {id: 'sad', type: 'number'},
                        {id: 'heartRate', type: 'number'},
                        {id: 'bmi', type: 'number'},
                        {id: 'communityPneumonia', type: 'select'},
                        {id: 'weakness', type: 'select'},
                        {id: 'charlson', type: 'number'},
                        {id: 'familyHistory', type: 'select'},
                        {id: 'dryWheezing', type: 'select'},
                        {id: 'consciousnessLoss', type: 'select'}
                    ];
                case 2:
                    return [
                        {id: 'creatinine', type: 'number'},
                        {id: 'hematocrit', type: 'number'}
                    ];
                case 3:
                    return [
                        {id: 'lvDysfunction', type: 'select'}
                    ];
                case 4:
                    return [
                        {id: 'hospitalPneumonia', type: 'select'}
                    ];
                default:
                    return [];
            }
        }

        function getModel1Data() {
            return {
                age: parseInt(document.getElementById('age').value),
                killip: parseInt(document.getElementById('killip').value),
                sad: parseInt(document.getElementById('sad').value),
                heartRate: parseInt(document.getElementById('heartRate').value),
                bmi: parseFloat(document.getElementById('bmi').value),
                communityPneumonia: parseInt(document.getElementById('communityPneumonia').value),
                weakness: parseInt(document.getElementById('weakness').value),
                charlson: parseInt(document.getElementById('charlson').value),
                familyHistory: parseInt(document.getElementById('familyHistory').value),
                dryWheezing: parseInt(document.getElementById('dryWheezing').value),
                consciousnessLoss: parseInt(document.getElementById('consciousnessLoss').value)
            };
        }

        function getModel2Data() {
            return {
                creatinine: parseFloat(document.getElementById('creatinine').value),
                hematocrit: parseFloat(document.getElementById('hematocrit').value)
            };
        }

        function getModel3Data() {
            return {
                lvDysfunction: parseInt(document.getElementById('lvDysfunction').value)
            };
        }

        function getModel4Data() {
            return {
                hospitalPneumonia: parseInt(document.getElementById('hospitalPneumonia').value)
            };
        }

        function sendData(data) {
            console.log('Отправка данных на сервер:', data);
            
            // Здесь будет реальная отправка данных на сервер
            // Пример:
            /*
            fetch('/api/calculate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(responseData => {
                console.log("Результат:", responseData);
                alert(`Результат расчета: ${responseData.result}`);
            })
            .catch(error => {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при расчете');
            });
            */
            
            alert(`Data for model ${data.targetModel} sent to server.\n`);
        }

        // Добавляем обработчики для сброса ошибок при вводе
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('input', function() {
                if (this.classList.contains('error')) {
                    this.classList.remove('error');
                    const errorElement = this.nextElementSibling;
                    if (errorElement && errorElement.classList.contains('error-message')) {
                        errorElement.style.display = 'none';
                    }
                }
            });
        });
    </script>
</body>
</html>