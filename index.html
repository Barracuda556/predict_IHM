<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор внутригоспитальной и 30-дневной летальности при остром коронарном синдроме без подъема сегмента ST</title>
    <style>
        body { 
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .form-group label {
            width: 350px;
            margin-right: 10px;
            font-weight: bold;
        }
        input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100px;
        }
        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 120px;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
            display: block;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .model-section {
            border-bottom: 2px solid #3498db;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .model-title {
            color: #3498db;
            margin-bottom: 15px;
        }
        .units {
            color: #666;
            font-size: 0.9em;
            margin-left: 5px;
        }
        .error {
            border-color: red !important;
        }
        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }
        .lang-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        .lang-btn {
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .lang-btn:hover {
            background-color: #ddd;
        }
        .lang-ru {
            display: block;
        }
        .lang-en {
            display: none;
        }
        body.lang-en .lang-ru {
            display: none;
        }
        body.lang-en .lang-en {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lang-switcher">
            <button class="lang-btn" onclick="switchLanguage('ru')">RU</button>
            <button class="lang-btn" onclick="switchLanguage('en')">EN</button>
        </div>
        
        <h1 class="lang-ru">Калькулятор внутригоспитальной и 30-дневной летальности при остром коронарном синдроме без подъема сегмента ST</h1>
        <h1 class="lang-en">Non-ST-segment elevation acute coronary syndrome in-hospital mortality calculator</h1>
        
        <!-- Модель 1 -->
        <div class="model-section" id="model1-section">
            <h2 class="model-title lang-ru">Поступление в стационар</h2>
            <h2 class="model-title lang-en">Upon admission</h2>
            <div class="form-group">
                <label for="age" class="lang-ru">Возраст <span class="units">(лет)</span>:</label>
                <label for="age" class="lang-en">Age <span class="units">(years)</span>:</label>
                <input type="number" id="age" name="age" min="18" max="120">
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="killip" class="lang-ru">Класс Killip:</label>
                <label for="killip" class="lang-en">Acute Heart Failure (AHF):</label>
                <select id="killip" name="killip">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="1" class="lang-ru">I класс</option>
                    <option value="1" class="lang-en">I (no AHF)</option>
                    <option value="2" class="lang-ru">II класс</option>
                    <option value="2" class="lang-en">II (rales and/or jugular vein distention (JVD))</option>
                    <option value="3" class="lang-ru">III класс</option>
                    <option value="3" class="lang-en">III (pulmonary edema)</option>
                    <option value="4" class="lang-ru">IV класс</option>
                    <option value="4" class="lang-en">IV (cardiogenic shock)</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="sad" class="lang-ru">САД <span class="units">(мм рт.ст., при поступлении)</span>:</label>
                <label for="sad" class="lang-en">Systolic Blood Pressure <span class="units">(mmHg)</span>:</label>
                <input type="number" id="sad" name="sad" min="50" max="250">
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="heartRate" class="lang-ru">ЧСС <span class="units">(уд/мин, при поступлении)</span>:</label>
                <label for="heartRate" class="lang-en">Heart Rate <span class="units">(Beats Per Minute (BPM))</span>:</label>
                <input type="number" id="heartRate" name="heartRate" min="30" max="200">
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="bmi" class="lang-ru">ИМТ <span class="units">(кг/м²)</span>:</label>
                <label for="bmi" class="lang-en">Body Mass Index (BMI) <span class="units">(kg/m²)</span>:</label>
                <input type="number" id="bmi" name="bmi" step="0.1" min="10" max="50">
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="communityPneumonia" class="lang-ru">Внебольничная пневмония:</label>
                <label for="communityPneumonia" class="lang-en">Community-Acquired Pneumonia (CAP):</label>
                <select id="communityPneumonia" name="communityPneumonia">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="0" class="lang-ru">Нет</option>
                    <option value="0" class="lang-en">No</option>
                    <option value="1" class="lang-ru">Да</option>
                    <option value="1" class="lang-en">Yes</option>
                    <option value="None" class="lang-ru">Неизвестно</option>
                    <option value="None" class="lang-en">Unknown</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="weakness" class="lang-ru">Симптомы слабости:</label>
                <label for="weakness" class="lang-en">Signs of weakness:</label>
                <select id="weakness" name="weakness">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="0" class="lang-ru">Нет</option>
                    <option value="0" class="lang-en">No</option>
                    <option value="1" class="lang-ru">Да</option>
                    <option value="1" class="lang-en">Yes</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="charlson" class="lang-ru">Индекс коморбидности Чарлсона <span class="units">(баллы)</span>:</label>
                <label for="charlson" class="lang-en">Charlson Comorbidity Index (CCI) <span class="units">(scores)</span>:</label>
                <input type="number" id="charlson" name="charlson" min="0" max="30">
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="familyHistory" class="lang-ru">Отягощенная наследственность по ССЗ:</label>
                <label for="familyHistory" class="lang-en">Family History of Cardiovascular Disease (FHCD):</label>
                <select id="familyHistory" name="familyHistory">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="0" class="lang-ru">Нет</option>
                    <option value="0" class="lang-en">No</option>
                    <option value="1" class="lang-ru">Да</option>
                    <option value="1" class="lang-en">Yes</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="dryWheezing" class="lang-ru">Сухие хрипы:</label>
                <label for="dryWheezing" class="lang-en">Dry crackles:</label>
                <select id="dryWheezing" name="dryWheezing">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="0" class="lang-ru">Нет</option>
                    <option value="0" class="lang-en">No</option>
                    <option value="1" class="lang-ru">Да</option>
                    <option value="1" class="lang-en">Yes</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="consciousnessLoss" class="lang-ru">Потеря сознания:</label>
                <label for="consciousnessLoss" class="lang-en">Syncope:</label>
                <select id="consciousnessLoss" name="consciousnessLoss">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="0" class="lang-ru">Нет</option>
                    <option value="0" class="lang-en">No</option>
                    <option value="1" class="lang-ru">Да</option>
                    <option value="1" class="lang-en">Yes</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <button class="btn lang-ru" onclick="calculate(1)">Рассчитать</button>
            <button class="btn lang-en" onclick="calculate(1)">Calculate</button>
        </div>
        
        <!-- Модель 2 -->
        <div class="model-section" id="model2-section">
            <h2 class="model-title lang-ru">После лабораторных исследований</h2>
            <h2 class="model-title lang-en">Laboratory data</h2>
            <div class="form-group">
                <label for="creatinine" class="lang-ru">Креатинин <span class="units">(мкмоль/л)</span>:</label>
                <label for="creatinine" class="lang-en">Creatinine <span class="units">(µmol/l)</span>:</label>
                <input type="number" id="creatinine" name="creatinine" step="0.1" min="20" max="1000">
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <div class="form-group">
                <label for="hematocrit" class="lang-ru">Гематокрит <span class="units">(%)</span>:</label>
                <label for="hematocrit" class="lang-en">Hematocrit <span class="units">(%)</span>:</label>
                <input type="number" id="hematocrit" name="hematocrit" step="0.1" min="10" max="60">
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <button class="btn lang-ru" onclick="calculate(2)">Рассчитать</button>
            <button class="btn lang-en" onclick="calculate(2)">Calculate</button>
        </div>
        
        <!-- Модель 3 -->
        <div class="model-section" id="model3-section">
            <h2 class="model-title lang-ru">После ЭхоКГ сердца</h2>
            <h2 class="model-title lang-en">Instrumental data</h2>
            <div class="form-group">
                <label for="lvDysfunction" class="lang-ru">Систолическая дисфункция левого желудочка (снижение фракции выброса ≤49%):</label>
                <label for="lvDysfunction" class="lang-en">Left ventricular systolic dysfunction (left ventricular ejection fraction (LVEF) ≤ 49%):</label>
                <select id="lvDysfunction" name="lvDysfunction">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="0" class="lang-ru">Нет</option>
                    <option value="0" class="lang-en">No</option>
                    <option value="1" class="lang-ru">Да</option>
                    <option value="1" class="lang-en">Yes</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <button class="btn lang-ru" onclick="calculate(3)">Рассчитать</button>
            <button class="btn lang-en" onclick="calculate(3)">Calculate</button>
        </div>
        
        <!-- Модель 4 -->
        <div class="model-section" id="model4-section">
            <h2 class="model-title lang-ru">В процессе госпитализации</h2>
            <h2 class="model-title lang-en">During hospitalization</h2>
            <div class="form-group">
                <label for="hospitalPneumonia" class="lang-ru">Внутрибольничная пневмония:</label>
                <label for="hospitalPneumonia" class="lang-en">Hospital-Acquired Pneumonia (HAP):</label>
                <select id="hospitalPneumonia" name="hospitalPneumonia">
                    <option value="">-- <span class="lang-ru">Выберите</span><span class="lang-en">Select</span> --</option>
                    <option value="0" class="lang-ru">Нет</option>
                    <option value="0" class="lang-en">No</option>
                    <option value="1" class="lang-ru">Да</option>
                    <option value="1" class="lang-en">Yes</option>
                </select>
                <div class="error-message lang-ru">Поле обязательно для заполнения</div>
                <div class="error-message lang-en">This field is required</div>
            </div>
            <button class="btn lang-ru" onclick="calculate(4)">Рассчитать</button>
            <button class="btn lang-en" onclick="calculate(4)">Calculate</button>
        </div>
    </div>

    <script>
        function switchLanguage(lang) {
            document.body.className = lang === 'en' ? 'lang-en' : '';
            // Сохраняем выбор языка в localStorage
            localStorage.setItem('preferredLanguage', lang);
        }

        // Проверяем сохраненный язык при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            const preferredLanguage = localStorage.getItem('preferredLanguage') || 'ru';
            switchLanguage(preferredLanguage);
        });

        function calculate(modelNumber) {
            // Собираем данные для всех требуемых моделей
            let data = {};
            let isValid = true;

            // Проверяем и собираем данные для модели 1 (всегда требуется)
            if (!validateModel(1)) {
                isValid = false;
            } else {
                data.model1 = getModel1Data();
            }

            // Если запрошены модели 2-4, проверяем и их
            if (modelNumber >= 2) {
                if (!validateModel(2)) {
                    isValid = false;
                } else {
                    data.model2 = getModel2Data();
                }
            }

            if (modelNumber >= 3) {
                if (!validateModel(3)) {
                    isValid = false;
                } else {
                    data.model3 = getModel3Data();
                }
            }

            if (modelNumber >= 4) {
                if (!validateModel(4)) {
                    isValid = false;
                } else {
                    data.model4 = getModel4Data();
                }
            }

            if (!isValid) {
                const errorMessage = document.body.classList.contains('lang-en') ? 
                    'Please fill in all required fields for the selected models' : 
                    'Пожалуйста, заполните все обязательные поля для выбранных моделей';
                alert(errorMessage);
                return;
            }

            // Добавляем номер целевой модели
            data.targetModel = modelNumber;
            
            // Отправляем данные на сервер
            sendData(data);
        }

        function validateModel(modelNumber) {
            let isValid = true;
            const fields = getModelFields(modelNumber);

            fields.forEach(field => {
                const element = document.getElementById(field.id);
                const errorElements = element.parentNode.querySelectorAll('.error-message');
                
                // Проверяем, заполнено ли поле
                if (!element.value || (element.type === 'number' && isNaN(element.value))) {
                    element.classList.add('error');
                    errorElements.forEach(el => el.style.display = 'block');
                    isValid = false;
                } else {
                    element.classList.remove('error');
                    errorElements.forEach(el => el.style.display = 'none');
                }
            });

            return isValid;
        }

        function getModelFields(modelNumber) {
            switch(modelNumber) {
                case 1:
                    return [
                        {id: 'age', type: 'number'},
                        {id: 'killip', type: 'select'},
                        {id: 'sad', type: 'number'},
                        {id: 'heartRate', type: 'number'},
                        {id: 'bmi', type: 'number'},
                        {id: 'communityPneumonia', type: 'select'},
                        {id: 'weakness', type: 'select'},
                        {id: 'charlson', type: 'number'},
                        {id: 'familyHistory', type: 'select'},
                        {id: 'dryWheezing', type: 'select'},
                        {id: 'consciousnessLoss', type: 'select'}
                    ];
                case 2:
                    return [
                        {id: 'creatinine', type: 'number'},
                        {id: 'hematocrit', type: 'number'}
                    ];
                case 3:
                    return [
                        {id: 'lvDysfunction', type: 'select'}
                    ];
                case 4:
                    return [
                        {id: 'hospitalPneumonia', type: 'select'}
                    ];
                default:
                    return [];
            }
        }

        function getModel1Data() {
            return {
                age: parseInt(document.getElementById('age').value),
                killip: parseInt(document.getElementById('killip').value),
                sad: parseInt(document.getElementById('sad').value),
                heartRate: parseInt(document.getElementById('heartRate').value),
                bmi: parseFloat(document.getElementById('bmi').value),
                communityPneumonia: parseInt(document.getElementById('communityPneumonia').value),
                weakness: parseInt(document.getElementById('weakness').value),
                charlson: parseInt(document.getElementById('charlson').value),
                familyHistory: parseInt(document.getElementById('familyHistory').value),
                dryWheezing: parseInt(document.getElementById('dryWheezing').value),
                consciousnessLoss: parseInt(document.getElementById('consciousnessLoss').value)
            };
        }

        function getModel2Data() {
            return {
                creatinine: parseFloat(document.getElementById('creatinine').value),
                hematocrit: parseFloat(document.getElementById('hematocrit').value)
            };
        }

        function getModel3Data() {
            return {
                lvDysfunction: parseInt(document.getElementById('lvDysfunction').value)
            };
        }

        function getModel4Data() {
            return {
                hospitalPneumonia: parseInt(document.getElementById('hospitalPneumonia').value)
            };
        }

        function sendData(data) {
            console.log('Отправка данных на сервер:', data);
            
            // Здесь будет реальная отправка данных на сервер
            // Пример:
            /*
            fetch('/api/calculate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(responseData => {
                console.log("Результат:", responseData);
                alert(`Результат расчета: ${responseData.result}`);
            })
            .catch(error => {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при расчете');
            });
            */
            
            const message = document.body.classList.contains('lang-en') ? 
                `Data for model ${data.targetModel} sent to server.\n` : 
                `Данные для моделей 1-${data.targetModel} отправлены на сервер.\nПроверьте консоль для деталей.`;
            alert(message);
        }

        // Добавляем обработчики для сброса ошибок при вводе
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('input', function() {
                if (this.classList.contains('error')) {
                    this.classList.remove('error');
                    const errorElements = this.parentNode.querySelectorAll('.error-message');
                    errorElements.forEach(el => el.style.display = 'none');
                }
            });
        });
    </script>
</body>
</html>